<!DOCTYPE html>
<html lang="en">
	<!-- Example code from http://www.patrick-wied.at/static/heatmapjs/example-heatmap-leaflet.html -->
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Bournemouth Bus Stop Coverage Heatmap</title>
		<link href='http://fonts.googleapis.com/css?family=Wellfleet' rel='stylesheet' type='text/css'>

		<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
		<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>

		<script type="text/javascript" src="js/heatmap.min.js"></script>
		<script type="text/javascript" src="js/leaflet-heatmap.js"></script>

	</head>
	<body>
		<center>
		<h1>Bournemouth Bus Stop Coverage Heatmap</h1>
		<div class="heatmap" id="map-canvas" style="width: 100%; height: 500px"></div>
		<div id="logos">
			Powered by<br/>
			<a href="http://leafletjs.com"><img src="img/leaflet.png" alt="Leaflet" /></a>
			<a href="http://openstreetmap.org"><img src="img/osm.png" alt="OpenStreetMap" /></a>
			<a href="http://bournemouthdata.io/"><img src="img/bournemouthdata.png" alt="Bournemouth Data" /></a>
		</div>
		</center>

		<script type="text/javascript" charset="utf-8">
			window.onload = function(){

				var data = (function() {
					var json = null;
					$.ajax({
					    'async': false,
					    'global': false,
					    'url': "data/bournemouth_grid.json",
					    'dataType': "json",
					    'success': function (data) {
						json = data;
					    }
					});
					return json;
				    })();

				console.log(data);

				var baseLayer = L.tileLayer(
				  'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
				    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>',
				    maxZoom: 18
				  }
				);

				var cfg = {
				  // radius should be small ONLY if scaleRadius is true (or small radius is intended)
				  "radius": 20,
				  "maxOpacity": .8, 
				  // scales the radius based on map zoom
				  "scaleRadius": false, 
				  // if set to false the heatmap uses the global maximum for colorization
				  // if activated: uses the data maximum within the current map boundaries 
				  //   (there will always be a red spot with useLocalExtremas true)
				  "useLocalExtrema": false,
				  // which field name in your data represents the latitude - default "lat"
				  latField: 'lat',
				  // which field name in your data represents the longitude - default "lng"
				  lngField: 'lng',
				  // which field name in your data represents the data value - default "value"
				  valueField: 'count'
				};


				var heatmapLayer = new HeatmapOverlay(cfg);

				var map = new L.Map('map-canvas', {
				  center: new L.LatLng(50.7273249, -1.8576807),
				  zoom: 12,
				  layers: [baseLayer, heatmapLayer]
				});

				heatmapLayer.setData(data);
			};
		</script>
	</body>
</html>
